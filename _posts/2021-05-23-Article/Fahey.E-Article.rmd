---
title: "Short Article"
description: |
  Article title will go here.
author:
  - name: Emma Fahey
date: "05/23/2021"
output:
  distill::distill_article:
    self_contained: false
---

```{r setup, include=FALSE}

# this code can be used for each chunk where applicable 
# code does or doesnâ€™t display inline (echo setting)
# figures are shown at various sizes (fig.width and fig.height settings)
# warnings and messages are suppressed (warning and message settings)
# computations are cached (cache setting)

knitr::opts_chunk$set(fig.width=8, fig.height=5, 
               echo=TRUE, 
               warning=FALSE, message=FALSE, 
               cache=TRUE)

```


```{r libraries and import, include=FALSE}

### Libraries - delete those uneeded. 
library(gendercoder)



# rstan options
rstan_options(auto_write = TRUE)
options(mc.cores = parallel::detectCores ())
theme_set(theme_classic())

# read/import data
df <- read_csv("processed_nature.csv") # reading the data. 

df$gender_code <- gendercoder::recode_gender(df$gender) # making the gender codes uniform as were free text entries. 

df <- mutate(df, age_clean = if_else(age < 1000, age, 2021 - age)) # cleaning age variable to remove extreme outliers. 

# reverse coding an item from the happiness scale 
df[,"shs_4_1"] <- lapply(df[,"shs_4_1" ], function(x){car::recode(x,"1 = 7; 2 = 6; 3 = 5; 4 = 4; 5 = 3; 6 = 2; 7 = 1")})

# create 3x new columns for motivation variable (as scale split in 3)
df$motsad <- (df[c("importance_1", "importance_2", "importance_3", "importance_4", "importance_5", "importance_6", "importance_7")])

df$mothap <- (df[c("importance_8", "importance_9", "importance_10", "importance_11")])

df$motref <- (df[c("importance_12", "importance_12", "importance_13", "importance_14")])

# generating mean scores for the scales. 
df$motsad <- rowMeans(df[paste0("importance_", 1:7)], na.rm = T)
df$mothap <- rowMeans(df[paste0("importance_", 8:11)], na.rm = T)
df$motref <- rowMeans(df[paste0("importance_", 12:14)], na.rm = T)
df$swls <- rowMeans(df[paste0("swl_", 1:5)], na.rm = T) 
df$shs <- rowMeans(df[paste0("shs_", 1:4, "_1")], na.rm = T) 

mean(df$age_clean, na.rm = T)

```

## Introduction 
Enter text here once final. 


## Method 

Participants (n = 303) were recruited through an undergraduate introduction to psychology course at Victoria University, Wellington, New Zealand. Participants were awarded course credit for taking part in the study.  

Age - Mean is 19.45 (SD = 4.46). Min 17, Max 69. 
Gender - Female 245 (80.8%), Male 47 (15.5%), non-binary (1%), 8 Missing (2.6%). 

One outlier was removed from the data set for having an age over 1000. 

Add in info about procedure. 

blah, blah - see below for table of scale distributions 


```{r descriptives, include=FALSE}

# select the variables needed 
df2 <- df %>%
  select(gender_code, age_clean, swl_1, swl_2, swl_3, swl_4, swl_5, swls, shs_1_1, shs_2_1, shs_3_1, shs_4_1, shs, motsad, mothap, motref)
head(df2) # checking the variables 

# table - code for descriptive stats of the scales (means etc.) 
table1::label(df$swls) <- "Life Satisfaction"
table1::label(df$shs) <- "Happiness"
table1::label(df$mothap) <- "Happy Motivation"
table1::label(df$motsad) <- "Sad Motivation"
table1::label(df$motref) <- "Reflective Motivation"

# actual table 
table1::table1(~ swls + shs + mothap + motsad + motref, data = df2)

# histograms - desriptive graphs to show distribution of the data 
p1 <-
  qplot(df$swls, geom = "histogram") + labs(title = "Life Satisfaction") + xlab("swls")
p2 <-
  qplot(df$shs, geom = "histogram") + labs(title = "Happiness") + xlab("shs")
p3 <- 
  qplot(df$mothap, geom = "histogram") + labs(title = "Happy Motivation") + xlab("mothap")
p4 <- 
  qplot(df$motsad, geom = "histogram") + labs(title = "Sad Motivation") + xlab("motsad")
p5 <- 
  qplot(df$motref, geom = "histogram") + labs(title = "Reflective Motivation") + xlab("motref")

p1 + p2 + p3 + p4 + p5

```

Distributions of the scales is shown in figure \@ref(fig:plots)
 
```{r plots, echo=FALSE, fig.cap= "Distribution of Scales"}
plot(p1 + p2 + p3 + p4 + p5)
```

   
```{r reliabilities, include=FALSE}

# alpha reliability calculation 
print(psych::alpha(df2[paste0("swl_", 1:5)]))
print(psych::alpha(df2[paste0("shs_", 1:4, "_1")]))
print(psych::alpha(df[paste0("importance_", 1:7)]))
print(psych::alpha(df[paste0("importance_", 8:11)]))
print(psych::alpha(df[paste0("importance_", 12:14)]))

# other reliability calculation 
print(ufs::scaleStructure(df2[paste0("swl_", 1:5)]))
print(ufs::scaleStructure(df2[paste0("shs_", 1:4, "_1")]))
print(ufs::scaleStructure(df[paste0("importance_", 1:7)]))
print(ufs::scaleStructure(df[paste0("importance_", 8:11)]))
print(ufs::scaleStructure(df[paste0("importance_", 12:14)]))

# these have been added to the apa format table in the code chunk below. 

```

The main descriptive statistics for each scale can be found in table 1. 
READ A JOURNAL ARTICLE TO SEE WHAT TO WRITE HERE. 

```{r, echo=FALSE, results='asis'}

# Create table data for apa format 

tab_01 = data.frame(
  scale = c("SHS", "SWLS", "MotHap", "MotSad", "MotRef"),
  Mean = c("4.27 (0.76)", "4.49 (1.27)", "5.13 (1.56)", 
           "4.04 (1.69)", "4.73 (1.82)"),
  Alpha = c("0.87", "0.84", "0.90", "0.94", "0.82"),
  Omega = c("0.89", "0.88", "0.92", "0.96", "0.83"), 
  Coefficient_H = c("0.88", "0.87", "0.94", "0.95", "0.85")
)

# apa format of a table 

kable(
  tab_01,
  format = "html",
  booktabs = TRUE,
  escape = FALSE,
  longtable = TRUE,
  col.names = c("Scale", "Mean", "Alpha", "Omega", "Coefficient_H"),
  align = c("l", "c", "c", "c", "c"),
  caption = "Means, Standard Deviations and reliabilities of Scales"
  ) %>%
  row_spec(row = 0, align = "c") %>%
  kable_styling(full_width = TRUE) %>%
  footnote(
    general_title = "Note.",
    general = "Standard deviations are in parentheses. SHS = Subjective Happiness Scale; SWLS = Satisfaction with Life Sacle; MotHap = Happy Motivation Scale; MotSad = Sad Motivation Scale; Motref = Refletive Motivation Scale.",
    threeparttable = TRUE,
    footnote_as_chunk = TRUE
    )

```

## Correlations

Below is an image of correlations shown in figure \@ref(fig:corr)
Correlation is run with Holm adjustment which means that it corrects for type 1 error. CHECK THIS. 


```{r corr, echo=FALSE, fig.cap= "Correlation Plot of Scales"}

ggstatsplot::ggcorrmat(df, c("age_clean", "swls", "shs", "motsad", "mothap", "motref"), 
                       cor.vars.names = c("age", "Life Satisfaction", "Happiness", "Sad Motivation", "Happy Motivation", "Reflective Motivation"))

```

### Networks 

The below is two graphs that show the connectedness of the scales used in the study. We can see that life satisfaction and happiness form a connection, as expected. The EGA graph shows that they are still separate constructs however. 

But the motivations subscales show that all 3 subscales are viewed as one construct, they are not independent and are strongly related. 


Figure play: A distribution of the scales is shown in figure \@ref(fig:net1)
 
```{r net1, echo=FALSE, fig.cap= "Network Graph"}
# creating a network map of scale items 
network1 <- bootnet::estimateNetwork(select(df2, -age_clean, -gender_code, -shs, -swls), "EBICglasso")
owl <- qgraph::qgraph(network1$graph, layout = "spring")
# the above shows that happiness and life satisfaction form a connection. 

```

Figure play: A distribution of the scales is shown in figure \@ref(fig:networks)

```{r networks, echo=FALSE, fig.cap= "EGA Graph"}

ega <- EGAnet::bootEGA(select(df2, -age_clean, -gender_code, -shs, -swls), iter = 1000)

# the above shows us that life satisfaction and happiness are independent constructs. 

```

So - we have a new netowrk graph that teasing out any connectinos between the importance scale. These graphs in the appendix, but talk about them here. 

```{r network for mot, echo=FALSE}

# this shows that there are 3 seperate constructs for motivation. 

df10 <- df %>%
  select(age_clean, gender_code, importance_1, importance_2, importance_3, importance_4, importance_5, importance_6, importance_7, importance_8, importance_9, importance_10, importance_11, importance_12, importance_13, importance_14, motsad, mothap, motref)

# creating a network map of scale items 
network3 <- bootnet::estimateNetwork(select(df10, -age_clean, -gender_code, -motsad, -mothap, -motref), "EBICglasso")
owl <- qgraph::qgraph(network3$graph, layout = "spring")
# the above shows that happiness and life satisfaction form a connection. 

ega3 <- EGAnet::bootEGA(select(df10, -age_clean, -gender_code, -motsad, -mothap, -motref), iter = 1000)
# the above shows us that life satisfaction and happiness are independent constructs. 

```

## Description of Model 
To test between x and y - we fit a xxxx model. We expected xxxxxx. We further tested a bootstrap... 

The IV was the three different motivations to visit a place. 
The DV was the life satisfaction and happiness scales. 

## The SEM model 

Report the model and the model stats in text. 


GOOGLE - what does this mean and how to interpret. 

Measures comparative fit. output of the second SEM means that gender doesn't seem to impact the SEM. So we collapse the model together. Fit doesn't differ. Regression paths identical between groups.

How do I report the above statistics? Just in text??? 

## Results 
one significant result. mothap with more shs. plus mothap is almost sig with swls - this likely due to the high correlation between shs and swls. so motsad and motref no effect. aka it is about knowing what makes happy, not what makes sad. 

```{r basic model code, include=FALSE}

# SEM to test hypoth

mdl_sem <- 'swls ~ motsad + mothap + motref
	shs ~ motsad + mothap + motref' # this is the model 

sem_res_strap <- sem(mdl_sem, df, se = "bootstrap", estimator = "ML")  
summary(sem_res_strap, standardize = T, fit = T) # this is running a bootstrap version of the above model. 


# second one - this sees if the model differs per gender. 
	
sem_res_1 <- sem(mdl_sem, filter(df2, gender_code %in% c("male", "female")), estimator = "ML", group = "gender_code", se = "bootstrap") 
sem_res_mtr <- sem(mdl_sem, filter(df2, gender_code %in% c("male", "female")), estimator = "ML", group = "gender_code", group.equal = "regressions", se = "bootstrap")
# MLR uses approx to multuvariate data and using scaling factor to adjust qui-squared. Like a students t-test. But instead we using ML (the norm), and bootstrap. This runs the analysis 1000 times to get an average answer. 


summary(sem_res_1, standardize = T, fit = T) 
summary(sem_res_mtr, standardize = T, fit = T)
# once generated these, we looking at the cfi - the differences. 

# Bootstrapping randomly grabs part of your data and makes a new average. Allows confidence intervals. 

# from this 2x sig (mothap and shs in both). 

```

```{r references, include=FALSE}

# content for the references 
report::cite_packages()

# add this in later. 

```

## Discussion 
Enter here. 

### Limitations and Future Research 
Enter here from word. 

## Appendix 
Enter the other EGA graphs here. 

